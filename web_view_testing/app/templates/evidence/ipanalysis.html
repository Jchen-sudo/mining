<!DOCTYPE html>
<html lang="zh-CN">

<head lang="en">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>可疑IP分析</title>

    <link href="../../static/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="../../static/bootstrap-3.3.5/css/bootstrap-theme.min.css" rel="stylesheet" type="text/css" />
    <link type="text/css" href="../../static/jquery-ui-bootstrap/css/custom-theme/jquery-ui-1.10.0.custom.css"
        rel="stylesheet" />

    <script src="../../static/bootstrap-3.3.5/js/jquery-1.11.3.min.js" type="text/javascript"></script>
    <script src="../../static/bootstrap-3.3.5/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="../../static/jquery-ui-bootstrap/assets/js/jquery-ui-1.10.0.custom.min.js"
        type="text/javascript"></script>

    <style>
        body {
            background-color: rgb(255, 255, 255);
            height: 100%;
        }

        iframe {
            margin-top: 0;
            width: 100%;
            border: 0px;
            min-height: calc(100vh);
            overflow: visible;
        }

        .alert {
            display: inline-block;
            margin: 0px auto;
            position: fixed;
            transition: 0.5s;
            z-index: 10800;
            top: 20px;
            right: 20px;
            animation-iteration-count: 1;
            animation-timing-function: ease-in-out;
            animation-fill-mode: forwards;
            animation-duration: 0.5s;
            word-wrap: break-word;
            opacity: 0.5;
        }

        .alert:hover {
            opacity: 1;
        }
    </style>

</head>

<body>
    <!-- 警告框 -->
    <div class="col-xs-11 col-sm-4 alert alert-success animated fadeInUp hide" role="alert">
        <strong>咕咕咕哒哒哒木大</strong>
    </div>

    <div class="container">
        <h2 class="text-center">可疑IP分析</h2>
    </div>
    <div class="container">
        <h3>已自动探查到的可疑IP <small>点击可查看详情</small> </h3>
    </div>


    <div class="bs-example" data-example-id="hoverable-table">
        <table class="table table-hover table-responsive  table-condensed table-striped">
            <thead>
                <tr>
                    <th class="text-center">序号</th>
                    <th class="text-center">IP</th>
                </tr>
            </thead>
            <tbody>
                {% for web in webdata %}
                <tr data-toggle="modal" data-target="#myModal">
                    <th scope="row" class="text-center" id="id">{{ web['data_id'] }}</th>
                    <td class="text-nowrap text-center">{{ web['data_IP'] }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- 模态框（Modal） -->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"
        style="width:600px;margin: 0 auto; word-break:break-all">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title" id="myModalLabel">IP详情</h4>
                </div>
                <div class="modal-body" style="height:400px; overflow-x: hidden;overflow-y:auto;">

                    <div class="container-fluid">
                        <div class="accordion" id="accordion">
                            <div class="mydata"></div>

                        </div>
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                </div>;
            </div>
        </div>
    </div>

    <!--table点击事件-->
    <script>
        $(function () {
            $("table > tbody > tr").click(function () {

            });
        })
    </script>

    <!--table点击事件-->
    <script>
        function copy(a) {
            let transfer = document.createElement('input');
            document.body.appendChild(transfer);
            transfer.value = a;  // 这里表示想要复制的内容
            transfer.focus();
            transfer.select();
            if (document.execCommand('copy')) {
                document.execCommand('copy');
            }
            transfer.blur();
            $('.alert > strong').text("已复制IP： " + a + " 到您的剪贴板");
            $('.alert').removeClass('hide');
            $('.alert').addClass('in');
            document.body.removeChild(transfer);
            setTimeout(function () {
                $('.alert').removeClass('in');
                $('.alert').addClass('hide');
            }, 6000);

        }
        $(function () {
            $("table > tbody > tr").click(function () {
                var ip = $(this).children('td').eq(0).text();
                copy(ip);
                $.ajax({
                    type: "GET",                //jquery 请求方式为 get
                    url: "http://ip-api.com/json/" + ip + "?lang=zh-CN",//jquery 请求URL
                    dataType: "json",           //jquery接受类型 可以 json js html 等数据
                    cache: false,               //是否缓存
                    success: function (data) {
                        var str='<ul  class="list-group list-group-flush" >';
                        var li = '<li class="list-group-item">';  
                        if (data.status == "success") {
                            for (var key in data) {
                                str += li + '<h4>' + key + '：</h4>' + data[key] + "</li>";
                            }
                        }else{
                            if (data.message == "private range") {
                                str += '<li class="list-group-item list-group-item-warning">' + "您所查询的 IP 为私有 IP</li>";
                            } else {
                                str += '<li class="list-group-item list-group-item-warning">' + "查询失败</li>";
                            }
                            
                            str += li + ""+ "失败原因： " + data.message +"</li>";
                            str += li + ""+ "您所查询的 IP： " + data.query +"</li>";
                        }
                        str+="</ul>";  
                        $(".mydata").html(str);
                    }
                });
            });
        })

    </script>

    <!--模态框拖拽-->
    <script>
        $("#myModal").draggable({
            handle: ".modal-header"
        });
    </script>

</body>

</html>